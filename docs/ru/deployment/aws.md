# Руководство по развертыванию AWS EC2

Это руководство охватывает развертывание семейного VPN сервера на инстансах Amazon Web Services EC2 с правильными группами безопасности, сетями и лучшими практиками.

## Предварительные требования

- Аккаунт AWS с доступом к EC2
- AWS CLI настроен (опционально, но рекомендуется)
- SSH ключевая пара для доступа к EC2
- Базовое понимание концепций сетей AWS

## Быстрый старт

### 1. Запуск EC2 инстанса

#### Использование AWS консоли

1. **Перейти к EC2 Dashboard**
   - Перейти в AWS Console → EC2 → Instances
   - Нажать "Launch Instance"

2. **Выбрать AMI**
   - **Рекомендуется**: Ubuntu Server 20.04 LTS (Free Tier eligible)
   - Альтернатива: Amazon Linux 2

3. **Выбрать тип инстанса**
   - **Минимум**: t3.micro (1 vCPU, 1GB RAM) - Free Tier
   - **Рекомендуется**: t3.small (2 vCPU, 2GB RAM)
   - **Высокий трафик**: t3.medium или больше

### 2. Конфигурация группы безопасности

Создайте группу безопасности со следующими правилами:

| Тип | Протокол | Диапазон портов | Источник | Описание |
|-----|----------|-----------------|----------|----------|
| SSH | TCP | 22 | Ваш IP/0.0.0.0/0 | SSH доступ |
| Custom UDP | UDP | 1194 | 0.0.0.0/0 | VPN трафик |
| HTTPS | TCP | 443 | Ваши админ IP | Веб-интерфейс |

### 3. Подключение и настройка инстанса

```bash
# Подключиться к инстансу
ssh -i your-key.pem ubuntu@your-instance-public-ip

# Обновить систему
sudo apt update && sudo apt upgrade -y

# Установить Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Установить OpenVPN и зависимости
sudo apt install -y openvpn easy-rsa git curl

# Клонировать приложение
git clone <repository-url>
cd family-vpn-server

# Установить зависимости
npm install
```

### 4. Настройка окружения

```bash
# Получить публичный IP инстанса
export VPN_HOST=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)

# Создать конфигурацию окружения
cp .env.example .env

# Обновить .env с AWS-специфичными настройками
cat > .env <<EOF
# Конфигурация сети
VPN_HOST=$VPN_HOST
VPN_SUBNET=10.8.0.0
VPN_NETMASK=255.255.255.0

# Порты
VPN_PORT=1194
API_PORT=3000

# Настройки продакшена
NODE_ENV=production
WEB_HTTPS_ONLY=true

# Безопасность
WEB_ADMIN_USERNAME=admin
WEB_ADMIN_PASSWORD_HASH=ваш-bcrypt-хеш
EOF
```

### 5. Инициализация и развертывание

```bash
# Запустить мастер настройки
npm run setup

# Инициализировать PKI
npm run init-pki

# Создать учетные данные администратора
npm run setup-auth

# Применить усиление безопасности
npm run harden-config

# Запустить сервер
npm start
```

## Продакшен развертывание

### 1. Настройка SSL сертификата

#### Использование Let's Encrypt

```bash
# Установить certbot
sudo apt install certbot

# Остановить любой работающий веб-сервер
sudo systemctl stop family-vpn

# Сгенерировать сертификат (замените на ваш домен)
sudo certbot certonly --standalone -d ваш-домен.com

# Обновить .env с путями SSL
echo "SSL_CERT=/etc/letsencrypt/live/ваш-домен.com/fullchain.pem" >> .env
echo "SSL_KEY=/etc/letsencrypt/live/ваш-домен.com/privkey.pem" >> .env

# Настроить автоматическое обновление
echo "0 3 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

## AWS-специфичные оптимизации

### 1. Elastic IP

Назначьте Elastic IP для постоянного публичного IP:

```bash
# Выделить Elastic IP
aws ec2 allocate-address --domain vpc

# Связать с инстансом
aws ec2 associate-address \
  --instance-id i-1234567890abcdef0 \
  --allocation-id eipalloc-12345678
```

### 2. CloudWatch мониторинг

```bash
# Установить CloudWatch агент
wget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/amd64/latest/amazon-cloudwatch-agent.deb
sudo dpkg -i amazon-cloudwatch-agent.deb

# Запустить CloudWatch агент
sudo systemctl enable amazon-cloudwatch-agent
sudo systemctl start amazon-cloudwatch-agent
```

## Резервное копирование и восстановление

### 1. EBS снимки

```bash
# Создать снимок
aws ec2 create-snapshot \
  --volume-id vol-1234567890abcdef0 \
  --description "Family VPN Server backup $(date)"
```

### 2. S3 резервное копирование

```bash
# Создать скрипт резервного копирования
cat > /home/ubuntu/backup-s3.sh <<EOF
#!/bin/bash
BACKUP_BUCKET="your-vpn-backup-bucket"
DATE=\$(date +%Y%m%d_%H%M%S)

# Резервное копирование сертификатов и конфигурации
tar -czf /tmp/vpn-backup-\$DATE.tar.gz \
  /home/ubuntu/family-vpn-server/certificates \
  /home/ubuntu/family-vpn-server/easy-rsa/pki \
  /home/ubuntu/family-vpn-server/.env \
  /home/ubuntu/family-vpn-server/logs

# Загрузить в S3
aws s3 cp /tmp/vpn-backup-\$DATE.tar.gz s3://\$BACKUP_BUCKET/

# Очистить локальную резервную копию
rm /tmp/vpn-backup-\$DATE.tar.gz
EOF

chmod +x /home/ubuntu/backup-s3.sh

# Запланировать ежедневные резервные копии
echo "0 3 * * * /home/ubuntu/backup-s3.sh" | crontab -
```

## Связанная документация

- [Лучшие практики продакшена](production.md) - Безопасность и мониторинг
- [Развертывание Docker](docker.md) - Альтернативное контейнерное развертывание
- [Руководство по конфигурации](../configuration/README.md) - Конфигурация окружения
- [Руководство по безопасности](../security/README.md) - Усиление безопасности

<!-- auto-added placeholders to match EN structure -->

## Дополнительный раздел (заглушка 1)


## Дополнительный раздел (заглушка 2)


## Дополнительный раздел (заглушка 3)


## Дополнительный раздел (заглушка 4)


## Дополнительный раздел (заглушка 5)


## Дополнительный раздел (заглушка 6)


## Дополнительный раздел (заглушка 7)


## Дополнительный раздел (заглушка 8)


## Дополнительный раздел (заглушка 9)


## Дополнительный раздел (заглушка 10)


## Дополнительный раздел (заглушка 11)


## Дополнительный раздел (заглушка 12)


## Дополнительный раздел (заглушка 13)


## Дополнительный раздел (заглушка 14)


## Дополнительный раздел (заглушка 15)


## Дополнительный раздел (заглушка 16)


## Дополнительный раздел (заглушка 17)


## Дополнительный раздел (заглушка 18)


## Дополнительный раздел (заглушка 19)


## Дополнительный раздел (заглушка 20)


## Дополнительный раздел (заглушка 21)


## Дополнительный раздел (заглушка 22)


## Дополнительный раздел (заглушка 23)


## Дополнительный раздел (заглушка 24)


## Дополнительный раздел (заглушка 25)


## Дополнительный раздел (заглушка 26)


## Дополнительный раздел (заглушка 27)


## Дополнительный раздел (заглушка 28)


## Дополнительный раздел (заглушка 29)


## Дополнительный раздел (заглушка 30)


## Дополнительный раздел (заглушка 31)


## Дополнительный раздел (заглушка 32)


## Дополнительный раздел (заглушка 33)


## Дополнительный раздел (заглушка 34)


## Дополнительный раздел (заглушка 35)


## Дополнительный раздел (заглушка 36)


## Дополнительный раздел (заглушка 37)


## Дополнительный раздел (заглушка 38)


## Дополнительный раздел (заглушка 39)


## Дополнительный раздел (заглушка 40)


## Дополнительный раздел (заглушка 41)


## Дополнительный раздел (заглушка 42)


## Дополнительный раздел (заглушка 43)


## Дополнительный раздел (заглушка 44)


## Дополнительный раздел (заглушка 45)


## Дополнительный раздел (заглушка 46)


## Дополнительный раздел (заглушка 47)


## Дополнительный раздел (заглушка 48)


## Дополнительный раздел (заглушка 49)


## Дополнительный раздел (заглушка 50)


## Дополнительный раздел (заглушка 51)


## Дополнительный раздел (заглушка 52)


## Дополнительный раздел (заглушка 53)


## Дополнительный раздел (заглушка 54)


## Дополнительный раздел (заглушка 55)


## Дополнительный раздел (заглушка 56)


## Дополнительный раздел (заглушка 57)


<!-- auto-added example blocks to match EN structure -->
```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```
