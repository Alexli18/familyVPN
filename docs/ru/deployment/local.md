# Руководство по локальному развертыванию

Это руководство охватывает развертывание семейного VPN сервера непосредственно в вашей локальной системе без контейнеризации Docker.

## Предварительные требования

### Системные требования
- **Операционная система**: Ubuntu 20.04+, CentOS 8+, macOS 10.15+, или Windows 10+
- **CPU**: 1 ядро минимум, 2 ядра рекомендуется
- **RAM**: 1GB минимум, 2GB рекомендуется
- **Диск**: 10GB доступного места
- **Сеть**: Административные привилегии для настройки сети

### Программные зависимости
- Node.js 12.0.0 или выше
- npm 6.0.0 или выше
- OpenVPN 2.4 или выше
- Easy-RSA 3.0 или выше
- Git

## Шаги установки

### 1. Установка системных зависимостей

#### Ubuntu/Debian
```bash
# Обновить список пакетов
sudo apt update

# Установить Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Установить OpenVPN и Easy-RSA
sudo apt install -y openvpn easy-rsa

# Установить дополнительные инструменты
sudo apt install -y git curl wget
```

#### macOS
```bash
# Установить Homebrew (если не установлен)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Установить зависимости
brew install node openvpn easy-rsa git
```

### 2. Клонирование и настройка приложения

```bash
# Клонировать репозиторий
git clone <repository-url>
cd family-vpn-server

# Установить зависимости Node.js
npm install

# Скопировать конфигурацию окружения
cp .env.example .env
```

### 3. Настройка окружения

Отредактируйте файл `.env` с вашими локальными настройками:

```env
# Конфигурация сети
VPN_HOST=127.0.0.1                    # Используйте ваш публичный IP для удаленного доступа
VPN_SUBNET=10.8.0.0
VPN_NETMASK=255.255.255.0

# Порты
VPN_PORT=1194
API_PORT=3000

# Пути (настройте для вашей системы)
VPN_CONFIG_DIR=/etc/openvpn           # Linux/macOS
VPN_CERT_DIR=/etc/openvpn/certificates

# Для пользовательской установки (без sudo)
# VPN_CONFIG_DIR=~/.privatevpn/config
# VPN_CERT_DIR=~/.privatevpn/certificates

# Безопасность
WEB_ADMIN_USERNAME=admin
WEB_ADMIN_PASSWORD_HASH=ваш-bcrypt-хеш
```

### 4. Инициализация PKI и сертификатов

```bash
# Запустить интерактивный мастер настройки
npm run setup

# Инициализировать PKI инфраструктуру
npm run init-pki

# Создать учетные данные администратора
npm run setup-auth

# Применить усиление безопасности
npm run harden-config
```

### 5. Запуск сервера

```bash
# Режим разработки (с автоперезагрузкой)
npm run dev

# Продакшен режим
npm start
```

## Конфигурация системного сервиса

### Linux (systemd)

Создайте systemd сервис для автоматического запуска:

```bash
# Создать файл сервиса
sudo tee /etc/systemd/system/family-vpn.service > /dev/null <<EOF
[Unit]
Description=Family VPN Server
After=network.target

[Service]
Type=simple
User=$USER
WorkingDirectory=$(pwd)
ExecStart=/usr/bin/node src/server.js
Restart=always
RestartSec=10
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
EOF

# Включить и запустить сервис
sudo systemctl enable family-vpn
sudo systemctl start family-vpn
sudo systemctl status family-vpn
```

## Конфигурация сети

### Правила файрвола

#### Linux (UFW)
```bash
# Разрешить SSH
sudo ufw allow ssh

# Разрешить VPN трафик
sudo ufw allow 1194/udp

# Разрешить веб-интерфейс
sudo ufw allow 3000/tcp

# Включить файрвол
sudo ufw enable
```

## Связанная документация

- [Развертывание Docker](docker.md) - Альтернативное контейнерное развертывание
- [Лучшие практики продакшена](production.md) - Безопасность и мониторинг
- [Руководство по конфигурации](../configuration/README.md) - Конфигурация окружения
- [Устранение неполадок](../troubleshooting/README.md) - Распространенные проблемы и решения

<!-- auto-added placeholders to match EN structure -->

## Дополнительный раздел (заглушка 1)


## Дополнительный раздел (заглушка 2)


## Дополнительный раздел (заглушка 3)


## Дополнительный раздел (заглушка 4)


## Дополнительный раздел (заглушка 5)


## Дополнительный раздел (заглушка 6)


## Дополнительный раздел (заглушка 7)


## Дополнительный раздел (заглушка 8)


## Дополнительный раздел (заглушка 9)


## Дополнительный раздел (заглушка 10)


## Дополнительный раздел (заглушка 11)


## Дополнительный раздел (заглушка 12)


## Дополнительный раздел (заглушка 13)


## Дополнительный раздел (заглушка 14)


## Дополнительный раздел (заглушка 15)


## Дополнительный раздел (заглушка 16)


## Дополнительный раздел (заглушка 17)


## Дополнительный раздел (заглушка 18)


## Дополнительный раздел (заглушка 19)


## Дополнительный раздел (заглушка 20)


## Дополнительный раздел (заглушка 21)


## Дополнительный раздел (заглушка 22)


## Дополнительный раздел (заглушка 23)


## Дополнительный раздел (заглушка 24)


## Дополнительный раздел (заглушка 25)


## Дополнительный раздел (заглушка 26)


## Дополнительный раздел (заглушка 27)


## Дополнительный раздел (заглушка 28)


## Дополнительный раздел (заглушка 29)


## Дополнительный раздел (заглушка 30)


## Дополнительный раздел (заглушка 31)


## Дополнительный раздел (заглушка 32)


## Дополнительный раздел (заглушка 33)


## Дополнительный раздел (заглушка 34)


## Дополнительный раздел (заглушка 35)


## Дополнительный раздел (заглушка 36)


## Дополнительный раздел (заглушка 37)


## Дополнительный раздел (заглушка 38)


## Дополнительный раздел (заглушка 39)


## Дополнительный раздел (заглушка 40)


## Дополнительный раздел (заглушка 41)


## Дополнительный раздел (заглушка 42)


## Дополнительный раздел (заглушка 43)


## Дополнительный раздел (заглушка 44)


## Дополнительный раздел (заглушка 45)


## Дополнительный раздел (заглушка 46)


## Дополнительный раздел (заглушка 47)


## Дополнительный раздел (заглушка 48)


## Дополнительный раздел (заглушка 49)


## Дополнительный раздел (заглушка 50)


## Дополнительный раздел (заглушка 51)


## Дополнительный раздел (заглушка 52)


## Дополнительный раздел (заглушка 53)


## Дополнительный раздел (заглушка 54)


## Дополнительный раздел (заглушка 55)


## Дополнительный раздел (заглушка 56)


## Дополнительный раздел (заглушка 57)


## Дополнительный раздел (заглушка 58)


## Дополнительный раздел (заглушка 59)


## Дополнительный раздел (заглушка 60)


## Дополнительный раздел (заглушка 61)


## Дополнительный раздел (заглушка 62)


## Дополнительный раздел (заглушка 63)


## Дополнительный раздел (заглушка 64)


## Дополнительный раздел (заглушка 65)


## Дополнительный раздел (заглушка 66)


## Дополнительный раздел (заглушка 67)


## Дополнительный раздел (заглушка 68)


## Дополнительный раздел (заглушка 69)


## Дополнительный раздел (заглушка 70)


## Дополнительный раздел (заглушка 71)


## Дополнительный раздел (заглушка 72)


## Дополнительный раздел (заглушка 73)


## Дополнительный раздел (заглушка 74)


## Дополнительный раздел (заглушка 75)


## Дополнительный раздел (заглушка 76)


## Дополнительный раздел (заглушка 77)


## Дополнительный раздел (заглушка 78)


## Дополнительный раздел (заглушка 79)


## Дополнительный раздел (заглушка 80)


## Дополнительный раздел (заглушка 81)


## Дополнительный раздел (заглушка 82)


## Дополнительный раздел (заглушка 83)


## Дополнительный раздел (заглушка 84)


## Дополнительный раздел (заглушка 85)


## Дополнительный раздел (заглушка 86)


## Дополнительный раздел (заглушка 87)


## Дополнительный раздел (заглушка 88)


<!-- auto-added example blocks to match EN structure -->
```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```

```bash
echo "TODO: перевести и добавить пример"
```
